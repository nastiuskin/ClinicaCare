@page "/logout"
@using Application.UserAccountManagement.UserDtos
@using ClinicaCare.Client.Pages.Dialogs
@using ClinicaCare.Client.Services
@using ClinicaCare.Client.Services.Interfaces
@using MudBlazor
@inject NavigationManager NavigationManager
@inject IAuthService AuthService
@inject IDialogService DialogService

@rendermode InteractiveWebAssembly

@code {
    private string[] errors = { };

    protected override async Task OnInitializedAsync()
    {
        await ShowLogoutConfirmation();
    }

    private async Task ShowLogoutConfirmation()
    {
        var options = new DialogOptions { CloseOnEscapeKey = true };
        var dialog = DialogService.Show<LogoutConfirmationDialog>("Logout Confirmation", options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            await UserLogout();
        }
        else
        {
            NavigationManager.NavigateTo("/");
        }
    }

    private async Task UserLogout()
    {
        var result = await AuthService.LogoutAsync();

        if (result.Success)
        {
            NavigationManager.NavigateTo("/login", true);
        }
        else
        {
            errors = result.Errors;
        }
    }
}
